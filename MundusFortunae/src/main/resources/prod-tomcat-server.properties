## 톰캣 / 내장서버 관련 ##

########################################
# 1. 기본 서버 설정
########################################

# 서버 포트 바꿔보기 (렌더에서 주는 환경변수)
server.port=${PORT:8080}

# 모든 URL 앞에 붙는 공통 prefix (ex. http://localhost:8081/queryjym/...)
server.servlet.context-path=/

# 어떤 IP에서 접속 허용할지 (로컬 개발이면 보통 0.0.0.0 혹은 주석처리)
server.address=0.0.0.0

# 애플리케이션 종료 시, 요청 처리 다 끝나고 천천히 내려가도록 (graceful shutdown)
server.shutdown=graceful
# 종료 대기 시간
spring.lifecycle.timeout-per-shutdown-phase=20s


########################################
# 2. 톰캣 쓰레드 / 커넥션 설정
########################################

# 최소 유지할 워커 쓰레드 수 (기본 10 근처)
server.tomcat.threads.min-spare=10

# 동시에 처리 가능한 최대 쓰레드 수 (CPU/메모리 생각하면서 50~200 사이에서 실험)
server.tomcat.threads.max=100

# 쓰레드가 꽉 찼을 때 큐에 쌓아둘 최대 대기 요청 수
server.tomcat.accept-count=100

# 동시에 유지 가능한 커넥션 수 (keep-alive 포함)
server.tomcat.max-connections=200

# 클라이언트가 연결만 해놓고 요청 안 보내고 있을 때 타임아웃
server.tomcat.connection-timeout=30s

# keep-alive 유효 시간
server.tomcat.keep-alive-timeout=20s

# 하나의 keep-alive 커넥션으로 몇 개 요청까지 허용할지
server.tomcat.max-keep-alive-requests=100


########################################
# 3. 응답 압축(GZIP) & HTTP/2
########################################

# GZIP 압축 활성화
server.compression.enabled=true

# 이 크기 이상인 응답에만 압축 적용
server.compression.min-response-size=1KB

# 어떤 MIME 타입의 응답에 압축할지
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,text/css,application/javascript

# HTTP/2 활성화 (HTTPS 환경에서 효과 있음)
server.http2.enabled=true


########################################
# 4. 정적 리소스 캐시 / 리소스 체인
########################################

# /static, /public 같은 정적 리소스의 캐시 기간 (초)
spring.web.resources.cache.period=3600

# Cache-Control 헤더 세부 설정
spring.web.resources.cache.cachecontrol.max-age=3600
spring.web.resources.cache.cachecontrol.cache-public=true

# 정적 리소스 버전 관리 전략 (파일 내용 바뀌면 자동으로 URL에 해시 붙여줌)
spring.web.resources.chain.enabled=true
spring.web.resources.chain.strategy.content.enabled=true
spring.web.resources.chain.strategy.content.paths=/**


########################################
# 5. HikariCP 커넥션 풀 (DB 연결 풀)
########################################

# 동시에 유지할 수 있는 최대 커넥션 수 (서버 스펙/DB 허용치 보면서 조절)
spring.datasource.hikari.maximum-pool-size=10

# 한가할 때 유지할 최소 커넥션 수
spring.datasource.hikari.minimum-idle=5

# 커넥션이 놀고 있을 때 얼마까지 기다렸다가 풀에서 빼버릴지
# 10분 (ms)
spring.datasource.hikari.idle-timeout=600000

# 커넥션이 살아 있을 수 있는 최대 수명 (DB/방화벽 idle cutoff 고려)
# 30분 (ms)
spring.datasource.hikari.max-lifetime=1800000

# 커넥션 얻기까지 기다릴 최대 시간
# 30초 (ms)
spring.datasource.hikari.connection-timeout=30000


########################################
# 6. 로깅 설정 (콘솔 로그, SQL 로그 등)
########################################

# 전체 기본 로그 레벨
logging.level.root=INFO

# 웹 요청 로그를 조금 더 보고 싶으면 (Controller, Handler 등)
logging.level.org.springframework.web=DEBUG

# JPA/Hibernate SQL 로그
logging.level.org.hibernate.SQL=DEBUG
# 바인딩 파라미터까지 보고 싶으면
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# 콘솔 로그 포맷 (시간 / 로그레벨 / 쓰레드 / 로거명 / 메시지)
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n


########################################
# 7. 톰캣 Access Log (웹서버 접근 로그)
########################################

# 톰캣 access log 활성화
server.tomcat.accesslog.enabled=true

# 로그 파일 위치 (기본은 톰캣 base/logs, 내장 톰캣은 프로젝트 실행 디렉토리 기준)
server.tomcat.accesslog.directory=logs

# 로그 파일 이름 규칙
server.tomcat.accesslog.prefix=access_log
server.tomcat.accesslog.suffix=.log
server.tomcat.accesslog.rotate=true

# 로그 포맷 (%h: IP, %u: 사용자, %t: 시간, "%r": 요청라인, %s: 상태코드, %b: 바이트 수, %D: 소요시간(ms))
server.tomcat.accesslog.pattern=%h %l %u %t "%r" %s %b %D


########################################
# 8. Actuator (헬스체크/메트릭 – 의존성 추가했을 때만 동작)
########################################

# 노출할 엔드포인트 (기본은 health/info 정도만)
management.endpoints.web.exposure.include=health,info,metrics

# /actuator/health 상세 정보 공개 여부
management.endpoint.health.show-details=when_authorized

# Actuator 기본 경로 변경 (옵션)
# management.endpoints.web.base-path=/manage


########################################
# 9. 기타 자잘한 것들 (실험용)
########################################

# 서버 에러 응답에 스택트레이스 표시 여부 (로컬 개발 때만 on)
server.error.include-stacktrace=always

# 에러 응답에 메시지도 포함할지
server.error.include-message=always

# 톰캣 요청 헤더/쿼리의 최대 크기 (보안/DoS 방어 측면에서 실험)
server.tomcat.max-http-form-post-size=2MB
server.tomcat.max-swallow-size=2MB